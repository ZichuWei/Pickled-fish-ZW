---
title: "Assignment2"
author: "Zichu Wei u7457435"
date: "2022/10/29"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Provide the link about my GitHub Repo 

[My GitHub Repository](https://github.com/ZichuWei/Pickled-fish-ZW)


## Statistical Analysis and Interpretation

### Load the necessary R Packages:

```{r,results='hide'}
# Data processing:
library(tidyverse)
library(readr)
library(dplyr)
library(plotrix)
```

```{r}
# Meta_analysis:
library(pacman)
pacman::p_load(metafor, orchaRd)
p_load(bookdown, devtools, tidyverse, ggforce, GGally, flextable, latex2exp, png,
    magick, metafor, MASS, emmeans, R.rsp)
devtools::install_github("daniel1noble/orchaRd", force = TRUE)
library(orchaRd)
```

```{r}
# Draw the figures:
library(ggplot2)
```


### Read the files:

```{r}
# These analyses need these three files.
data <- read.csv("OA_activitydat_20190302_BIOL3207.csv")
paper <- read.csv("clark_paper_data.csv")
meta <- read.csv("ocean_meta_data.csv")
```

### Process and clean the original data:

```{r}
# Drop irrelevant columns 'loc' and 'comment':
data_clean <- subset(data,select = -c(loc, comment))
# Remove the missing data, which reflected by 'NA';
# Remove the incorrect data: some data cannot less than 0, so use filter to check and correct the data.
data_eff <- data_clean %>% filter(!is.na(activity)) %>% filter(animal_id > 0, activity > 0)
data_eff
```

```{r}
# Check spelling in species and treatment:
data_eff$species %>% unique()
data_eff$treatment %>% unique()
```

```{r}
# Because we find that there are six species and two treatments which are all correct, so we don't need to change or remove some data.
```


### 1. Summary statistics:

```{r}
# Because the following analyses need to analyze different treatment, so use 'filter' to separate the treatment:
data_ctrl <- data_eff %>% filter(treatment=="control")
data_oa <- data_eff %>% filter(treatment=="CO2")
```

#### Gnerate the summary staistics for different levels:

Use 'group_by' and 'summarize' to generate the summary statistics (means, SD, N) for each fish species' average activity for each treatment.

```{r}
# Control: According to the column name in the 'meta-data_ocean_meta.csv' file, set the column as 'ctrl.mean', 'ctrl.sd', 'ctrl.n':
data1 <- data_ctrl %>% group_by(species) %>% summarize(ctrl.mean = mean(activity), ctrl.sd = sd(activity), ctrl.n = length(species))
data1
```

```{r}
# CO2: According to the column name in the 'meta-data_ocean_meta.csv' file, set the column as 'oa.mean', 'oa.sd', 'oa.n':
data2 <- data_oa %>% group_by(species) %>% summarize(oa.mean = mean(activity), oa.sd = sd(activity), oa.n = length(species))
data2
```

```{r}
# Merge the summary statistics for the following processing:
data_1 <- merge(data1,data2)
data_1
```


### 2-3. Merge summary statistics with the metadata:

#### 2. Metadata in 'clark_paper_data.csv' file:

Merge the summary statistics generated from the above with the metadata in 'clark_paper_data.csv' file:

```{r}
# Use 'merge' function to merge 'data_1' with 'paper', let the sequence as 'paper' in the left.
data_2 <- merge(paper,data_1)
data_2
```

#### 3. Metadata in 'ocean_meta_data.csv' file:

Merge the combined summary statistics 'data_1' and metadata from Clark et al. 'paper' (output 'data_2') into the larger meta-analysis dataset 'ocean_meta_data.csv' file:

```{r}
# Use 'rbind()' function to merge 'data_2' with 'meta':
# We can find that 'meta' and 'data_2' have different colnames, and both have very informal colnames, so we can use 'janitor::clean_names()' to polish them:
data_3 <- rbind(meta %>% janitor::clean_names(),data_2 %>% janitor::clean_names())
data_3$residual <- 1:dim(data_3)[1]
# We find 'oa_mean' and 'oa_sd' both have some NA values, in order to help the following analysis, then we first remove them.
data_4 <- data_3 %>% filter(!is.na(oa_mean)) %>% filter(!is.na(oa_sd))
summary(data_4)
```






